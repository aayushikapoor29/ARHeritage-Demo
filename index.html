<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Heritage - Ellora Caves</title>
    <script src="https://cdn.jsdelivr.net/gh/aframevr/aframe@1c2407b26c61958baa93967b5412487cd94b290b/dist/aframe-master.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        
        #loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: white;
            font-family: Arial, sans-serif;
        }
        
        #loading h2 {
            margin-bottom: 20px;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #info {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            z-index: 1000;
            text-align: center;
            max-width: 80%;
        }
        
        #error {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            font-family: Arial, sans-serif;
            z-index: 10000;
            display: none;
            max-width: 80%;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="loading">
        <h2>Loading Ellora Caves AR Experience</h2>
        <div class="spinner"></div>
        <p style="margin-top: 20px;">Please allow camera access...</p>
    </div>
    
    <div id="error"></div>
    
    <div id="info">Point your camera at the Hiro marker</div>
    
    <a-scene
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;"
        renderer="logarithmicDepthBuffer: true; precision: medium;"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false">
        
        <!-- Camera -->
        <a-entity camera></a-entity>
        
        <!-- Marker: Hiro Pattern -->
        <a-marker preset="hiro">
            <!-- 3D Model - Using a simple box as placeholder -->
            <!-- Replace with your actual GLB model path -->
            <a-box 
                position="0 0.5 0" 
                rotation="0 45 0"
                scale="1 1 1"
                color="#8B4513"
                animation="property: rotation; to: 0 405 0; loop: true; dur: 10000; easing: linear">
            </a-box>
            
            <!-- Temple structure representation -->
            <a-box position="0 0 0" scale="2 0.2 2" color="#A0522D"></a-box>
            <a-box position="0 0.5 0" scale="1.8 1 1.8" color="#CD853F"></a-box>
            <a-box position="0 1 0" scale="1.6 0.5 1.6" color="#DEB887"></a-box>
            
            <!-- Pillars -->
            <a-cylinder position="-0.8 0.5 -0.8" radius="0.1" height="1" color="#8B7355"></a-cylinder>
            <a-cylinder position="0.8 0.5 -0.8" radius="0.1" height="1" color="#8B7355"></a-cylinder>
            <a-cylinder position="-0.8 0.5 0.8" radius="0.1" height="1" color="#8B7355"></a-cylinder>
            <a-cylinder position="0.8 0.5 0.8" radius="0.1" height="1" color="#8B7355"></a-cylinder>
            
            <!-- Info text -->
            <a-text 
                value="Ellora Caves" 
                position="0 1.5 0" 
                align="center" 
                color="#FFD700"
                width="3"
                rotation="0 0 0">
            </a-text>
            
            <!-- Uncomment this when you have your actual model -->
            <!--
            <a-entity
                gltf-model="url(./modelglb/ellora.glb)"
                scale="0.5 0.5 0.5"
                position="0 0 0"
                rotation="0 0 0">
            </a-entity>
            -->
        </a-marker>
        
        <!-- Backup marker: Custom Pattern -->
        <!-- You can generate custom markers at: https://jeromeetienne.github.io/AR.js/three.js/examples/marker-training/examples/generator.html -->
        <a-marker type="pattern" url="./markers/pattern-marker.patt">
            <a-sphere position="0 0.5 0" radius="0.5" color="#EF2D5E"></a-sphere>
            <a-text value="Custom Marker!" position="0 1 0" align="center"></a-text>
        </a-marker>
    </a-scene>
    
    <script>
        // Hide loading screen once AR is ready
        window.addEventListener('load', function() {
            setTimeout(function() {
                const loading = document.getElementById('loading');
                if (loading) {
                    loading.style.display = 'none';
                }
            }, 3000);
        });
        
        // Handle marker detection
        const marker = document.querySelector('a-marker');
        if (marker) {
            marker.addEventListener('markerFound', function() {
                console.log('Marker detected!');
                const info = document.getElementById('info');
                if (info) {
                    info.innerHTML = 'Marker detected! Viewing Ellora Caves AR Model';
                    info.style.background = 'rgba(0, 128, 0, 0.7)';
                }
            });
            
            marker.addEventListener('markerLost', function() {
                console.log('Marker lost');
                const info = document.getElementById('info');
                if (info) {
                    info.innerHTML = 'Point your camera at the Hiro marker';
                    info.style.background = 'rgba(0, 0, 0, 0.7)';
                }
            });
        }
        
        // Handle camera errors
        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(function(stream) {
                console.log('Camera access granted');
                stream.getTracks().forEach(track => track.stop());
            })
            .catch(function(err) {
                console.error('Camera access error:', err);
                const errorDiv = document.getElementById('error');
                const loading = document.getElementById('loading');
                if (errorDiv) {
                    errorDiv.style.display = 'block';
                    errorDiv.innerHTML = `
                        <h3>Camera Access Required</h3>
                        <p>Please allow camera access to use AR features.</p>
                        <p>Error: ${err.message}</p>
                        <button onclick="location.reload()" style="margin-top: 10px; padding: 10px 20px; background: white; color: black; border: none; border-radius: 5px; cursor: pointer;">Retry</button>
                    `;
                }
                if (loading) {
                    loading.style.display = 'none';
                }
            });
    </script>
</body>
</html>
